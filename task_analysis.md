# Context
Filename: task_analysis.md
Created On: 2024-01-01
Created By: AI Assistant
Associated Protocol: RIPER-5 + Multidimensional + Agent Protocol

# Task Description
用户希望重构项目结构，使其支持 `from 'aurora-virtual-scrolling/react'` 和 `from 'aurora-virtual-scrolling/vue'` 这样的导入方式。用户明确表示先不写组件，主要关注配置文件的更改。包名保持为 `aurora-virtual-scrolling`。

# Project Overview
这是一个名为 "aurora-virtual-scrolling" 的虚拟滚动库项目，支持 React 和 Vue 两个框架。当前项目结构包含：
- 使用 Vite 作为构建工具
- 支持 TypeScript
- 已配置 React 和 Vue 插件
- 目标是构建一个库文件

---
*The following sections are maintained by the AI during protocol execution*
---

# Analysis (Populated by RESEARCH mode)

## 当前项目结构分析

### 1. 包配置分析
- **package.json**: 
  - 包名: `aurora-virtual-scrolling`
  - 当前导出配置只支持单一入口点 `./dist/index.js`
  - 已配置 React 和 Vue 相关的开发依赖

### 2. 构建配置分析
- **vite.config.ts**:
  - 使用单一入口点 `package/index.ts`
  - 已配置 React 和 Vue 插件
  - 构建为库格式，支持 ES、CJS、UMD 格式
  - 外部化了 'vue', 'react', 'react-dom'

### 3. TypeScript 配置分析
- **tsconfig.json**:
  - 包含 `package/**/*` 目录
  - 已配置声明文件生成

### 4. 目录结构分析
- `package/react-virtual-scrolling/` - React 组件目录（目前为空）
- `package/vue-virtual-scrolling/` - Vue 组件目录（目前为空）
- Git 状态显示已删除的文件：
  - `package/constants/index.ts`
  - `package/index.ts`
  - `package/types/index.ts`
  - `package/utils/index.ts`

## 技术约束和要求

### 1. 导入方式目标
- 支持 `from 'aurora-virtual-scrolling/react'` 导入 React 组件
- 支持 `from 'aurora-virtual-scrolling/vue'` 导入 Vue 组件
- 这需要配置子路径导出 (subpath exports)

### 2. 包名称确认
- 用户确认包名保持为 `aurora-virtual-scrolling`
- 导入路径将是 `aurora-virtual-scrolling/react` 和 `aurora-virtual-scrolling/vue`

### 3. 构建配置需求
- 需要支持多入口点构建
- 需要为 React 和 Vue 分别创建独立的构建输出
- 需要配置适当的外部依赖处理

## 关键发现
1. 项目当前处于重构状态，核心文件已被删除
2. 需要重新设计包的导出结构以支持子路径导入
3. 需要调整构建配置以支持多入口点
4. 包名已确认保持为 `aurora-virtual-scrolling`

# Proposed Solution (Populated by INNOVATE mode)

## 推荐方案：多入口点构建 + Monorepo 风格组织

### 核心设计理念
采用多入口点构建策略，结合 monorepo 风格的内部代码组织，实现框架特定的优化和清晰的架构分离。

### 方案优势
- **清晰的架构分离**：React 和 Vue 代码完全独立，便于维护和扩展
- **最小化包体积**：每个子包只包含相关框架的代码
- **良好的开发体验**：支持 TypeScript 类型推断和框架特定的优化
- **标准化实践**：符合 npm 包的子路径导出标准

### 技术实现策略

#### 1. 目录结构重组
```
package/
├── react/
│   ├── index.ts          # React 组件入口
│   ├── components/       # React 组件实现
│   └── types.ts          # React 特定类型
├── vue/
│   ├── index.ts          # Vue 组件入口
│   ├── components/       # Vue 组件实现
│   └── types.ts          # Vue 特定类型
├── shared/
│   ├── types/           # 共享类型定义
│   ├── utils/           # 共享工具函数
│   └── constants/       # 共享常量
└── index.ts             # 主入口（可选，用于通用功能）
```

#### 2. 构建输出结构
```
dist/
├── react/
│   ├── index.js
│   ├── index.d.ts
│   └── index.js.map
├── vue/
│   ├── index.js
│   ├── index.d.ts
│   └── index.js.map
├── index.js             # 主入口构建输出
├── index.d.ts
└── index.js.map
```

#### 3. 包配置策略
- **子路径导出**：配置 `package.json` 的 `exports` 字段
- **类型声明**：为每个子路径提供独立的类型声明文件
- **依赖管理**：React 和 Vue 作为 peerDependencies

#### 4. 构建工具配置
- **Vite 多入口点**：配置多个构建目标
- **TypeScript 支持**：确保类型声明正确生成
- **外部依赖处理**：框架特定的外部依赖配置

### 替代方案考虑

#### 方案 A：单一构建多导出
- 优点：构建配置简单
- 缺点：包体积较大，包含所有框架代码

#### 方案 B：完全独立的包
- 优点：最大化的独立性
- 缺点：维护复杂度高，共享代码重复

#### 方案 C：动态导入模式
- 优点：运行时灵活性
- 缺点：类型推断困难，构建复杂度高

### 最终推荐
推荐采用**多入口点构建 + Monorepo 风格组织**的方案，这种方案在代码组织、构建优化、开发体验和维护性之间达到了最佳平衡。

# Implementation Plan (Generated by PLAN mode)

## 实施计划概述
将当前的单一入口点项目重构为支持多入口点的结构，实现 `from 'aurora-virtual-scrolling/react'` 和 `from 'aurora-virtual-scrolling/vue'` 的导入方式。

## 详细变更计划

### [变更计划 1]
- **文件**: package.json
- **理由**: 配置子路径导出，支持 `/react` 和 `/vue` 导入方式
- **具体修改**: 
  - 更新 `exports` 字段，添加子路径导出配置
  - 添加 `peerDependencies` 配置
  - 更新 `files` 字段，包含新的构建输出目录

### [变更计划 2]
- **文件**: vite.config.ts
- **理由**: 重构构建配置，支持多入口点构建
- **具体修改**:
  - 配置多个构建目标（React、Vue、主入口）
  - 设置不同的外部依赖处理策略
  - 配置类型声明文件生成路径

### [变更计划 3]
- **文件**: tsconfig.json
- **理由**: 优化 TypeScript 配置，支持新的目录结构
- **具体修改**:
  - 更新 `include` 路径，包含新的目录结构
  - 配置路径映射，便于开发时的模块解析

### [变更计划 4]
- **目录**: package/
- **理由**: 创建新的目录结构，支持框架分离和共享代码
- **具体修改**:
  - 创建 `package/react/` 目录和入口文件
  - 创建 `package/vue/` 目录和入口文件
  - 创建 `package/shared/` 目录用于共享代码
  - 创建主入口文件 `package/index.ts`

### [变更计划 5-8]
- **文件**: 各种入口文件和类型文件
- **理由**: 创建基础的代码结构，支持后续的组件开发

## Implementation Checklist:
1. 更新 package.json 配置子路径导出和依赖管理
2. 重构 vite.config.ts 支持多入口点构建
3. 优化 tsconfig.json 配置支持新目录结构
4. 创建 package/react/ 目录结构
5. 创建 package/vue/ 目录结构
6. 创建 package/shared/ 目录结构
7. 创建 package/react/index.ts 入口文件
8. 创建 package/vue/index.ts 入口文件
9. 创建 package/shared/types/index.ts 共享类型文件
10. 创建 package/index.ts 主入口文件
11. 测试构建配置是否正常工作
12. 验证导入路径是否按预期工作

# Current Execution Step (Updated by EXECUTE mode when starting a step)
> Currently executing: "5. 创建 package/vue-virtual-scrolling/ 目录结构"

# Task Progress (Appended by EXECUTE mode after each step completion)
* 2024-01-01 14:30:00
  * Step: 1. 更新 package.json 配置子路径导出和依赖管理
  * Modifications: 
    - 更新 package.json 的 exports 字段，添加 ./react 和 ./vue 子路径导出
    - 添加 peerDependencies 配置，包含 react、react-dom、vue
    - 添加 peerDependenciesMeta 配置，将所有 peer 依赖设为可选
    - 更新 files 字段，包含 dist/react 和 dist/vue 目录
  * Change Summary: 配置了子路径导出支持，添加了框架依赖管理
  * Reason: 执行计划步骤 1
  * Blockers: None
  * User Confirmation Status: Success
* 2024-01-01 14:35:00
  * Step: 2. 重构 vite.config.ts 支持多入口点构建
  * Modifications: 
    - 将单一入口点改为多入口点配置（index、react、vue）
    - 更新 fileName 函数支持多入口点的目录结构
    - 保留 ES、CJS 和 UMD 格式（根据用户反馈修正）
    - 配置构建输出路径为 dist/react/ 和 dist/vue/
  * Change Summary: 重构了 Vite 构建配置，支持多入口点构建
  * Reason: 执行计划步骤 2
  * Blockers: None
  * User Confirmation Status: Success
* 2024-01-01 14:40:00
  * Step: 3. 优化 tsconfig.json 配置支持新目录结构
  * Modifications: 
    - 添加 baseUrl 配置为当前目录
    - 配置 paths 映射，支持 @/* 别名指向 package/*
    - 添加 @/shared/*、@/react/*、@/vue/* 路径映射
  * Change Summary: 优化了 TypeScript 配置，支持新的目录结构和路径映射
  * Reason: 执行计划步骤 3
  * Blockers: TypeScript 配置报错，因为 package 目录下还没有文件
  * User Confirmation Status: Success
* 2024-01-01 14:45:00
  * Step: 4. 创建 package/react/ 目录结构
  * Modifications: 
    - 创建 package/react/ 目录
    - 创建 package/react/components/ 子目录
  * Change Summary: 创建了 React 组件的目录结构
  * Reason: 执行计划步骤 4
  * Blockers: None
  * User Confirmation Status: Success
* 2024-01-01 14:50:00
  * Step: 5. 创建 Vue 组件基础架构并修复 TypeScript 报错
  * Modifications: 
    - 创建 package/vue-virtual-scrolling/ 目录和组件结构
    - 创建 package/react-virtual-scrolling/ 目录和组件结构
    - 创建 package/shared/ 目录结构（types、utils、constants）
    - 创建 Vue 组件基础架构（VirtualScrolling.vue）
    - 创建 React 组件基础架构（VirtualScrolling.tsx）
    - 创建共享类型定义文件
    - 创建主入口文件
    - 添加 JSX 支持到 tsconfig.json
    - 修复 Vue 和 React 组件的类型问题
    - 创建 Vue 模块声明文件 (vue-shim.d.ts)
    - 修复 vue-virtual-scrolling/index.ts 的类型声明冲突
    - 重构 Vue 插件支持 app.use() 方式使用
    - 创建 Vue 组件使用说明文档
  * Change Summary: 根据用户反馈创建了完整的组件架构，支持标准的 Vue 3 插件使用方式
  * Reason: 执行计划步骤 5（根据用户反馈调整）
  * Blockers: None
  * Status: Pending Confirmation 
